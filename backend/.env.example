# Brain (OpenAI-compatible) for text rewrite (洗稿)
BRAIN_API_KEY=sk-xxx
BRAIN_BASE_URL=http://127.0.0.1:4000/v1
BRAIN_MODEL=gemini-3-pro

# Painter (image edit/img2img) - keep as Google flagship combo
PAINTER_EDIT_URL=http://127.0.0.1:3000/replicate/images/edits
PAINTER_TOKEN=xxx
# Some Painter gateways expose Banana Pro as "google/nano-banana".
PAINTER_MODEL=google/nano-banana

# Enforce model family (optional hard guardrail)
ENFORCE_GOOGLE_MODELS=true

# Optional: matting sidecar
MATTING_BASE_URL=http://127.0.0.1:8911

# XHS crawler (Playwright persistent profile)
# XHS_USER_DATA_DIR is required for stable one-time login reuse.
XHS_USER_DATA_DIR=/Users/yourname/.xhs-playwright-profile
XHS_PLAYWRIGHT_HEADLESS=false
XHS_CRAWL_TIMEOUT=60

# Auto login within the same /xhs/extract request (recommended)
XHS_AUTO_LOGIN_ON_401=true
XHS_AUTO_LOGIN_WAIT_MS=120000
XHS_AUTO_LOGIN_POLL_INTERVAL_MS=1000

# Persist exported cookies to backend/.env (so /xhs/image can use it immediately)
XHS_COOKIE_PERSIST_TO_ENV=true
# XHS_COOKIE_ENV_PATH=/absolute/path/to/backend/.env
XHS_COOKIE_PERSIST_MIN_INTERVAL_S=60

# AB images (配图仿写)
# 并发度（图片数 * levels 会并发跑，但外部 Painter 可能会限流；建议 2~4 之间试）
# AB_IMAGES_CONCURRENCY=2
#
# V2 mask-edit：保护产品但允许重绘原图阴影/倒影
# 产品核心阈值（越大越“只保护产品本体”，更容易去掉原图阴影/倒影）
# AB_PRODUCT_CORE_THRESHOLD=224
#
# 先做一次开运算（腐蚀+膨胀）去掉“阴影突起”等噪声（像素）
# AB_PRODUCT_MASK_OPEN_PX=3
#
# 可选：进一步缩小“核心保护区”（像素）。越大越不容易把原图阴影/倒影保留下来，
# 但也更容易误伤到包装文字/Logo。建议默认 0。
# AB_PRODUCT_CORE_ERODE_PX=0
#
# 保护区阈值（用于保护产品边缘，避免出现“产品被改写后又叠加回去”的贴图感）。
# 越小保护越大（更不容易动到产品），越大保护越小（更容易去掉边缘阴影/倒影）。
# 默认约等于 AB_PRODUCT_CORE_THRESHOLD-40。
# AB_PRODUCT_PROTECT_THRESHOLD=200
#
# 保护边缘膨胀（越大越不容易动到产品边缘，但也更容易残留原图阴影/倒影）
# AB_MASK_PROTECT_DILATE_PX=4
#
# aggressive 下额外把“可编辑区域”向内收一点，进一步避免背景重绘侵入产品边缘（像素）。
# AB_V2_AGGRESSIVE_EDIT_ERODE_PX=2
#
# 细节保真：只在产品核心区做高频细节迁移，避免把原图阴影/倒影带回去
# AB_DETAIL_TRANSFER_THRESHOLD=224
# AB_DETAIL_TRANSFER_INNER_ERODE_PX=8
